:root {
  --h1-color: #bb4c2a;
  --h2-color: #EE9B00;
  --h3-color: #57C302;
  --h4-color: #0993D3;
  --h5-color: #9084E9;
  --h6-color: #F177FF;
  --h1-size: 2rem;
  --h2-size: 1.8rem;
  --h3-size: 1.6rem;
  --h4-size: 1.4rem;
  --h5-size: 1.3rem;
  --h6-size: 1.2rem;
  --h1-weight: 700;
  --h2-weight: 600;
  --h3-weight: 550;
  --h4-weight: 500;
  --h5-weight: 500;
  --h6-weight: 450;
  --transition: all .2s ease-in;
}

.theme-light {
  --text-selection: var(--file-item-bg);

  --external-link: #fc7747;
  --internal-link: #5d94ca;
  --external-link-hover: #fc774722;
  --internal-link-hover: #5d94ca22;
  --inline-code: var(--red);
  --strong: #0eadda;
  --quote: var(--file-item-bg);
  --strong: var(--text-accent);
  --thead: #ffefa9;
  --hr: 2px dashed var(--text-accent);
  --tag: var(--thead);
  --highlight-line: #bcd4fd65;
  --highlight-search: #ff8851;
}

.theme-dark {
  --text-selection: #619cd34d;

  --external-link: #fc7747dd;
  --internal-link: #58a8fadd;
  --external-link-hover: #ff7f5033;
  --internal-link-hover: #58a8fa33;
  --inline-code: var(--red);
  --strong: #00708f;
  --quote: var(--file-item-bg);
  --strong: var(--text-accent);
  --thead: #48576993;
  --hr: 2px dashed var(--text-accent);
  --tag: var(--thead);
  --highlight-line: #8297bb21;
  --highlight-search: #e977428c;
}

@mixin hover {
  &:hover {
    box-shadow: var(--shadow);
    transition: var(--transition);
    filter: var(--hover);
  }
}

//code
.markdown-preview-view {
  pre[class*="language-"] {
    padding: .8rem !important;
    padding-top: 3rem !important;
    position: relative;
    border-radius: 8px !important;
    background-color: #181c20;

    code {
      padding: 0 !important;
      font-size: 1rem !important;
      line-height: 1.8rem;
      border-radius: 0 !important;
      font-size: 1rem !important;
      white-space: pre;
    }

    .copy-code-button {
      font-family: 'Microsoft YaHei';
      box-sizing: border-box;
      letter-spacing: 3px;
      font-size: .8rem !important;
      padding: 0 !important;
      padding-left: 5px !important;
      border-radius: 5px !important;
      width: 50px;
      height: 1.6rem;
      line-height: 1.6rem;
      top: .3rem !important;
      right: .3rem !important;
      margin: 0px !important;
      display: unset !important;
      color: var(--interactive-normal);
      background-color: var(--text-accent-hover);

      @include hover()
    }

    &::before {
      font-weight: bold;
      position: absolute;
      box-sizing: border-box;
      letter-spacing: 1px;
      padding-left: 14px;
      width: 100%;
      left: 10px;
      height: 2.2rem;
      line-height: 2.2rem;
      top: 0px;
      margin-left: -10px;
      border-top-left-radius: 8px;
      border-top-right-radius: 8px;
      background-color: var(--language-title);
      color: #fff;
    }
  }

}

$language: c,
properties,
python,
nginx,
css,
js,
php,
lua,
shell,
powershell,
flow,
sequence,
sql,
yml,
ini,
xml,
git,
cs,
cpp,
java,
html,
txt,
md,
bat,
json,
groovy;

pre[class*='language-']:before {
  content: "未知语言";
}

@each $lan in $language {
  pre[class~='language-#{$lan}']::before {
    $t: to-upper-case($string: $lan);
    content: quote($t);
  }
}

/*===== 语法高亮 =====*/
:root {
  //底色
  --color-basic: #b7d1ae;
  //xml标签，选择器
  --color-selector: #e45276;
  //数字
  --color-number: #B1CBE8;
  //加减法、括号
  --color-operator: #d6ccb3;
  //属性、类名
  --color-property: #ee9f55;
  //字符串
  --color-string: #1ac847;
  //@metadata、单位
  --color-annotation: #499eff;
  //注释
  --color-comment: #666;
  //关键字
  --color-important: #B8A1FF;
  //方法
  --color-function: #7ab8ff;
}

//==预览==
.markdown-preview-section {
  pre {
    &.language-css code {
      color: var(--color-string);
    }

    code {

      &,
      &.url {
        color: var(--color-basic) !important;
      }

      .token {

        &.number {
          color: var(--color-number) !important;
          font-weight: bold;
        }

        &.selector,
        &.tag {
          color: var(--color-selector) !important;
        }

        &.punctuation,
        &.operator {
          color: var(--color-operator) !important;
        }

        &.property,
        &.attr-name,
        &.class-name {
          color: var(--color-property) !important;
        }

        &.string,
        &.important,
        &.attr-value {
          color: var(--color-string) !important;
        }

        &.annotation.punctuation,
        &.annotation.punctuation,
        &.unit {
          color: var(--color-annotation) !important;
        }

        &.doctype *,
        &.comment,
        &.comment * {
          color: var(--color-comment) !important;
        }

        // yml
        &.atrule,
        &.variable,
        &.boolean,
        &.keyword {
          color: var(--color-important) !important;
        }

        &.function {
          color: var(--color-function) !important;
        }
      }
    }
  }

}

//==编辑==
.cm-num {
  color: var(--color-number) !important;
}

//xml标签
.cm-tag {
  color: var(--color-selector) !important;
}

//括号
.cm-bracket {
  color: var(--color-operator) !important;
}

.cm-def,
.cm-type,
.cm-attribute {
  color: var(--color-property) !important;
}

.cm-string {
  color: var(--color-string) !important;
}

.cm-comment {
  color: var(--color-comment) !important;
}

.cm-keyword {
  color: var(--color-important) !important;
}


//行内代码
.cm-inline-code {
  color: var(--inline-code) !important;
}

//链接
.cm-link,
.external-link {
  color: var(--external-link) !important;

  &:hover {
    background-color: var(--external-link-hover);
  }
}

.cm-url,
.internal-link {
  color: var(--internal-link) !important;

  &:hover {
    background-color: var(--internal-link-hover);
  }
}

.cm-url {
  font-weight: bold;
}

.cm-formatting-link,
.cm-formatting-link-string {
  color: var(--color-string) !important;
}


//键盘
kbd {
  user-select: none;
}

.theme-light {
  kbd {
    box-shadow: var(--shadow-outset);
  }
}

.theme-dark {
  kbd {
    background-color: var(--file-item-selected-bg);
  }
}

@mixin absolute-center {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
}

//标题
@for $i from 1 through 6 {

  .cm-header-#{$i},
  h#{$i} {
    color: var(--h#{$i}-color) !important;
    font-size: var(--h#{$i}-size) !important;
    font-weight: var(--h#{$i}-weight) !important;
  }

  .HyperMD-header-#{$i} {
    padding: 4px 0 !important;
  }

  div:not(.popover) h#{$i} {
    position: relative;

    &::before {
      @include absolute-center();
      margin-left: -24px;
      font-size: .9rem;
      content: "H#{$i}";
      opacity: 0;
      transition: var(--transition);
    }

    &:hover::before {
      transition: var(--transition);
      opacity: 1;
    }
  }


  @if $i==5 {

    .cm-header-#{$i},
    h#{$i} {
      font-variant: small-caps;
    }
  }

  @else if $i==6 {

    .cm-header-#{$i},
    h#{$i} {
      font-variant: small-caps;
    }
  }

}

h1 {
  text-align: center;
}

h2 {
  border-bottom: 3px solid var(--h2);
}

.cm-header-5,
h5,
.cm-header-6,
h6 {
  font-weight: normal !important;
}

//==引用==
//预览
.markdown-preview-view blockquote {
  border: none !important;
  border-left: 8px solid var(--quote) !important;

  margin: {
    left: 0;
    top: 10px;
    bottom: 10px;
  }

  padding: {
    top: 15px;
    bottom: 15px;
    left: 20px;
  }
}

//编辑
.HyperMD-quote {
  border-color: var(--quote) !important;

  padding: {
    top: 10px !important;
    bottom: 10px !important;
  }
}

//表格
.markdown-preview-view table {

  width: 100% !important;

  th {
    background-color: var(--thead);
    text-align: left;

    &[align="right"] {
      text-align: right;
    }

    &[align="center"] {
      text-align: center;
    }
  }

  th,
  td {
    border: 2px solid #666;
    word-wrap: break-word;
  }
}

//列表

ul,
ol {
  padding-inline-start: .8rem;

  ul,
  ol {
    padding-inline-start: .8rem;
  }

  li {
    margin: 6px auto;

    &::marker {
      color: var(--internal-link);
    }
  }

  margin: {
    top: 2px;
    bottom: 2px;
    left: 1rem;
  }
}

ul>li>ul>li {
  list-style: square;

  ul>li {
    list-style: circle;
  }
}

//分割线
.hr.cm-line::after {
  content: "";
  width: 100%;
  height: 1px;
  border-top: var(--hr);
  border-bottom: var(--hr);
}

.markdown-preview-view hr {
  margin: 15px auto;
  border-top: var(--hr);
  border-bottom: var(--hr);
}

//标签
.markdown-preview-view a.tag {
  padding: 2px 10px;
  background-color: var(--tag);
  border-radius: 12px;
  text-decoration: none;

  @include hover()
}

.cm-line {

  .cm-hashtag-begin,
  .cm-hashtag-end {
    background-color: var(--tag);
    padding-top: 2px;
    padding-bottom: 2px;
    text-decoration: none !important;
  }

  .cm-hashtag-begin {
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
    padding-left: 10px;
  }

  .cm-hashtag-end {
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
    padding-right: 10px;
  }
}

//任务列表
.HyperMD-task-line {

  // height: 1.4rem;
  // line-height: 1.4;
  padding: {
    top: 0 !important;
  }

}

.markdown-preview-view .task-list-item {
  margin: 10px auto;
}

.task-list-item-checkbox {
  filter: none;
}

//内嵌文档
.app-container .workspace .internal-embed.is-loaded {
  margin: 10px auto !important;
  border-radius: 8px;
  transition: var(--transition);

  &:hover {
    transition: var(--transition);
  }

  .markdown-embed-link,
  .file-embed-link {
    top: 16px;
  }

  &.image-embed {
    margin: 2px;
  }
}

.theme-light .internal-embed.is-loaded {
  box-shadow: var(--shadow-outset);

  &:hover {
    transition: var(--transition);
    box-shadow: 0 0 8px 2px #c0c0c0;
  }

  .markdown-embed {
    border: none;
  }

  @at-root .theme-light .app-container .workspace .markdown-preview-view {

    .excalidraw-svg,
    .internal-embed.is-loaded.image-embed {
      margin: 0 !important;
      padding: 0;
      box-shadow: none;

      &:hover {
        box-shadow: none;
      }

      img {
        padding: 6px;
        border-radius: 6px;
        box-shadow: var(--shadow-outset);
        transition: var(--transition);

        &:hover {
          transition: var(--transition);
          box-shadow: 0 0 8px 2px #c0c0c0;
        }
      }
    }
  }
}

.theme-dark .internal-embed.is-loaded {
  border: 4px solid var(--file-item-bg);

  &:hover {
    border-color: var(--file-item);
  }

  &.image-embed {
    filter: brightness(90%);
  }

  @at-root .theme-dark .app-container .workspace .markdown-preview-view {

    .excalidraw-svg,
    .internal-embed.is-loaded.image-embed {
      margin: 0 !important;
      padding: 0;
      border: none;

      &:hover {
        border: none;
      }

      img {
        padding: 6px;
        border-radius: 8px;
        border: 4px solid var(--file-item-bg);
        transition: var(--transition);

        &:hover {
          transition: var(--transition);
          border-color: var(--file-item);
        }
      }
    }
  }
}

//==高亮==
//高亮行
.cm-active.cm-line {
  background-color: var(--highlight-line) !important;
  border-radius: 4px;
}

//搜索选中高亮
.cm-s-obsidian span.obsidian-search-match-highlight,
.search-result-file-matched-text,
.is-flashing,
mark,
.cm-s-obsidian span.cm-formatting-highlight,
.cm-s-obsidian span.cm-highlight {
  background-color: var(--highlight-search) !important;

  &,
  & * {
    color: #fff !important;
  }
}

.is-flashing,
.search-highlight div.is-active {
  font-weight: bold;
  transition: 1s all ease-out;
  background-color: unset !important;
  border: 2px solid var(--highlight-search);
  border-radius: 4px;
}

//行距
p,
.cm-line {
  line-height: 2rem;
  font-size: 1.1rem !important;

  padding: {
    left: 0 !important;
    top: 0 !important;
    bottom: 0 !important;
  }

  height: fit-content !important;
  border: 0;
}

.HyperMD-header {
  margin-top: 4px !important;
}

.HyperMD-codeblock {
  line-height: 1.8rem !important;
  font-size: 1rem !important;

  .HyperMD-codeblock .cm-formatting,
  .code-block-flair {
    color: var(--inline-code) !important;
  }
}

.cm-cursor {
  border-width: 2px !important;
}