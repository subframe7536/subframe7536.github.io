## 文件/路径
### 查看当前路径 pwd
```shell
pwd
```
### 查看文件列表 ls
```shell
ls [-] <目录>
```

| 参数 | 含义                      |
| ---- | ------------------------- |
| -a   | 列出包括隐藏文件所有文件  |
| -l   | 详细信息                  |
| -R   | 列出文件夹下的所有文件    |
| -F   | 可执行文件后加*,目录后加/ |

#### 查看所有文件和类型
```shell
ls -alF
```
### 输出文件内容 cat
```shell
cat [-] <文件>
```

| 参数 | 含义                                                         |
| ---- | ------------------------------------------------------------ |
| -n   | 显示行号                                                     |
| -b   | 显示行号,对于空白行不编号                                    |
| -s   | 显示行号,当遇到有连续两行以上的空白行,就代换为一行的空白行。 |

### 将结果输出到文件 >/>>
#### 覆写文件
```shell
cat file1.txt file2.txt > file.txt
```
#### 追加文件
```shell
cat file1.txt >> file2.txt
```
### 进入目录 cd
```shell
cd <路径>
```
### 创建目录 mkdir
```shell
mkdir [-] [-m <权限(数字)>] <目录>
```

| 参数   | 含义                                 |
| ------ | ------------------------------------ |
| -p     | 递归创建目录(没有父目录就创建父目录) |

### 修改文件时间(创建文件) touch
- 没有文件则创建新文件
```shell
touch [-][-d date][-r 目录] [-t date] <目录/文件>
```

| 参数    | 含义                                     |
| ------- | ---------------------------------------- |
| -a      | 改变文件的读取时间记录                   |
| -m      | 改变文件的修改时间记录                   |
| -c      | 没有文件则不创建文件                     |
| -d date | 设定时间与日期，可以使用各种不同的格式   |
| -t date | 设定档案的时间记录，格式与 date 指令相同 |
| -r 目录 | 递归修改时间                             |

### 复制文件 cp
```shell
cp [-] <源目录/文件> <目的目录/文件>
cp [-] <文件> <文件>.. <目录>
```
- 文件和目录支持通配符

| 参数 | 含义                                                      |
| ---- | --------------------------------------------------------- |
| -a   | 保留链接和文件属性,并复制目录下的所有内容(用于复制文件夹) |
| -d   | 复制时保留链接                                            |
| -f   | 覆盖已经存在的目标文件                                    |
| -r   | 复制该目录下所有的子目录和文件。                          |
| -l   | 不复制文件，只是生成链接文件。                            |

#### 复制文件夹并覆盖
```shell
cp -af test /tmp # 复制到/tmp文件夹下，路径为/tmp/test
```
### 移动文件 mv
```shell
mv [-] <源目录/文件> <目的目录/文件>
mv [-] <文件> <文件>.. <目录>
```
- 文件和目录支持通配符

| 参数 | 含义                                                     |
| ---- | -------------------------------------------------------- |
| -b   | 当目标文件或目录存在时，在执行覆盖前，会为其创建一个备份 |
| -f   | 覆盖旧文件                                               |
| -n   | 不要覆盖任何已存在的文件或目录                           |

#### 移动文件夹创建备份并覆盖
```shell
mv -bf test /tmp/test 
```
### 删除文件 rm
```shell
rm [-] <目录/文件>
```

| 参数 | 含义         |
| ---- | ------------ |
| -r   | 递归删除文件 |
| -i   | 确认是否删除 |
| -f   | 强制删除     |

#### 删除文件夹
```shell
rm -r test
```
### 备份压缩解压 tar
将文件目录进行打包，生成备份(归档)文件
生成过程中可以使用压缩方法，如gzip，bzip2，zip
```shell
tar [-] <备份文件> <需备份目录/文件>......
```

| 参数 | 含义                       |
| ---- | -------------------------- |
| -c   | 建立档案                   |
| -x   | 解压档案                   |
| -t   | 查看内容                   |
| -r   | 向压缩归档文件末尾追加文件 |
| -u   | 更新原压缩包中的文件       |
| -z   | 使用gzip压缩或者解压       |
| -j   | 使用bzip2压缩或解压        |
| -v   | 归档过程中显示所有压缩文件 |
| -f   | 归档过程中显示所有压缩文件 |
| -C   | 指定解压后的路径           |

#### 压缩目录
```shell
tar -zcvf 压缩包.tar.gz 源目录 
```
#### 解压压缩包
```shell
tar -zxvf 压缩包.tar.gz -C 解压目录
```
#### 查看压缩包内文件
```shell
tar -ztvf 压缩包.tar.gz
```
### 查找文件 find
```shell
find <目录> [-] [-exec/-ok 命令 {} \;]
```

| 参数              | 含义                                                 |
| ----------------- | ---------------------------------------------------- |
| -name "文件名"    | 按照文件名搜索，支持通配符                           |
| -mtime -n/+n      | 按文件更改时间来查找文件，-n指n天以内，+n指n天以前   |
| -atime -n/+n      | 按文件访问时间来查找文件，-n指n天以内，+n指n天以前   |
| -ctime -n/+n      | 按文件创建时间来查找文件，-n指n天以内，+n指n天以前   |
| -type b/d/c/p/l/f | 查找是块设备、目录、字符设备、管道、符号链接、普通文件 |
| -size n(c)        | 查找长度为n块(或n字节)的文件                           |

- -exec，对获取的文件使用命令
- -ok，同上，但是需要用户确认
#### 递归搜索后缀名为c的文件
```shell
find . -name "*.c"
```
#### 删除/var/log中7日前修改的普通文件并二次确认
```shell
find /var/log -type f -mtime +7 -ok rm {} \;
```
## 用户/权限
### 用户管理
#### 用户创建 useradd
```shell
useradd [-][-c <备注>][-d <登入目录>][-e <账号有效期限>][-f <密码失效后关闭账号的天数>][-g <群组>][-G <附加群组>][-s <shell>][-u <uid>][用户帐号]
```

| 参数 | 含义                           |
| ---- | ------------------------------ |
| -m   | 自动建立用户的登入目录       |
| -M   | 不要自动建立用户的登入目录   |
| -n   | 取消建立以用户名称为名的群组 |
| -r   | 建立系统帐号             |

- 默认无法登录，需要设置密码才能登录 
- adduser在Ubuntu系统中会自动创建用户目录和提示创建密码
#### 用户查看
所有用户信息存储在`/etc/passwd`
所有用户密码存储在`/etc/shadow`，只有root权限可以查看
#### 用户修改 usermod
```shell
usermod [-][-c <备注>][-d <登入目录>][-e <账号有效期限>][-f <密码失效后关闭账号的天数>]\
[-g <群组>][-G <附加群组>][-s <shell>][-u <uid>][用户帐号]
```

| 参数 | 含义                     |
| ---- | ------------------------ |
| -L   | 锁定用户密码，使密码无效 |
| -U   | 解除密码锁定             |

#### 用户删除 userdel
```shell
userdel [-][用户账号]
```

| 参数 | 含义               |
| ---- | ------------------ |
| -r   | 删除用户目录及文件 |

### 修改权限
![[权限.png]]
#### 用户权限 chown
```shell
chown [-] user:[group] <目录/文件>
```

| 参数  | 含义                                 |
| ----- | ------------------------------------ |
| user  | 设置拥有该文件权限的用户             |
| group | 设置拥有该文件权限的组               |
| -f    | 忽略错误信息                         |
| -R    | 处理指定目录以及其子目录下的所有文件 |

#### 读写权限 chmod
```shell
chmod [-] [ugoa] [+=-] [rwxX] <目录/文件>
```

| 参数 | 含义                   |
| ---- | ---------------------- |
| -c   | 二次确认               |
| -f   | 强制变更               |
| -v   | 显示权限变更的详细资料 |
| -R   | 递归的方式逐个变更     |

| 身份 | 含义                                    |
| ---- | --------------------------------------- |
| u    | 该文件的拥有者                          |
| g    | 与该文件的拥有者属于同一个群体(group)者 |
| o    | 其他以外的人                            |
| a    | 这三者皆是。                            |

| 措施 | 含义         |
| ---- | ------------ |
| +    | 增加权限     |
| -    | 取消权限     |
| =    | 唯一设定权限 |

| 权限 | 含义   |
| ---- | ------ |
| r    | 可读取 |
| w    | 可写入 |
| x    | 可执行 |

### root模式
#### 进入
```shell
sudo -i
sudo su root
```
#### 退出
```shell
exit
```
### 查看系统信息 uname
```shell
uname [-amnrsv]
```

| 参数 | 含义               |
| ---- | ------------------ |
| -a   | 全部的信息         |
| -m   | 电脑类型           |
| -n   | 在网络上的主机名称 |
| -r   | 操作系统的发行编号 |
| -s   | 操作系统名称       |
| -v   | 操作系统的版本     |

## 文本处理
### grep
```shell
grep [-] <正则表达式> <文件或文本或目录(使用-r参数)>
```

| 参数    | 含义                                               |
| ------- | -------------------------------------------------- |
| -E      | 开启扩展的正则表达式(或者使用egrep)                |
| -i      | 忽略大小写                                         |
| -v      | 只输出没有匹配的                                   |
| -n      | 显示行号                                           |
| -w      | 被匹配的文本只能是单词，而不能是单词中的某一部分   |
| -c      | 显示匹配到的行数                                   |
| -o      | 只显示被模式匹配到的字符串。                       |
| --color | 将匹配到的内容以颜色高亮显示                       |
| -r      | 递归匹配目录中的文件                               |
| -A  n   | 显示匹配到的字符串所在的行及其后n行，(after)       |
| -B  n   | 显示匹配到的字符串所在的行及其前n行，(before)      |
| -C  n   | 显示匹配到的字符串所在的行及其前后各n行，(context) |

#### 查找字符串
```shell
grep test.* -r testdir
```
### sed
```shell
sed [-] '[sed内置命令字符]' <文件>
```

| 参数选项 | 解释                                   |
| -------- | -------------------------------------- |
| -n       | 只输出处理结果，常与sed内置命令p一起用 |
| -i       | 直接将修改结果写入文件                 |
| -e       | 多次编辑,不需要管道符了                |
| -r       | 支持正则扩展                           |

| sed的内置命令字符          | 解释                                                    |
| -------------------------- | ------------------------------------------------------- |
| <匹配范围>a <内容>         | append,对文本追加，在指定行后面添加一行/多行文本(\n)    |
| <匹配范围>i <内容>         | insert，表示插入文本，在指定行前添加一行/多行文本(\n)   |
| <匹配范围>c <内容>         | 取代匹配行，在指定行替换一行/多行文本(\n)               |
| <匹配范围>d                | Delete,删除匹配行                                       |
| <匹配范围>p                | Print，打印匹配行的内容，通常p与-n一起用                |
| <匹配范围>s/正则/替换内容/ | 匹配正则内容，然后替换内容(支持正则)，结尾g代表全局匹配 |

| 范围        | 解释                           |
| ----------- | ------------------------------ |
| 空地址      | 全文处理                       |
| 单地址      | 指定文件某一行                 |
| /pattern/   | 被模式匹配到的每一行，需要转义           |
| 范围区间    | 10,20(10~20行)，10,+5(10~15行) |
| 步长        | 1~2(1,3,5……行)                 |
| $           | 最后一行                       |
| <匹配范围>! | 匹配范围不执行                 |

- 命令之间可以用分号进行分割
#### 输出3、6行
```shell
sed -n '3p;6p' test.list
```
#### 删除第5行到最后一行
```shell
sed '5,$d' test.list
```
#### 在第4行后添加内容
```shell
sed '4a testtest' test.list
```
#### 查找带有asd或者qwe的行
```shell
sed -n '/asd\|qwe/ p' test.list
```
#### 替换所有my为I
```shell
sed 's/my/I/g p' test.list
```
#### 倒序输出文件
```shell
sed '1!G;h;$!d' test.list
```
- [sed之G、H、g、h使用 - fhefh - 博客园 (cnblogs.com)](https://www.cnblogs.com/fhefh/archive/2011/11/22/2259097.html)
### awk
- 对行的内容进行处理
```shell
awk [-] <模式> '[动作]' <文件>
```

| 参数 | 含义                       |
| ---- | -------------------------- |
| -F   | 指定分割字段符             |
| -V   | 定义或修改一个awk内部的变量 |
| -f   | 从脚本文件中读取awk命令    |

| 内置变量                     | 含义                              |
| ---------------------------- | --------------------------------- |
| $n                           | 指定分隔符后，当前记录的第n个字段 |
| $0                           | 完整的输入记录                    |
| FS/`,`                       | 字段分隔符，默认是空格            |
| NF(Number of fields)         | 分割后，当前行一共有多少个字段    |
| NR(Number of records)        | 当前记录数，行数                  |
| FNR(File number of records)  | 当前文件行数                      |
| RS(Record separator)         | 输入的行分隔符(支持正则)          |
| ORS(Output record separator) | 输出的换行符                      |
| MORE VARIABLE                | man awk                           |

| 模式  | 含义                       |
| ----- | -------------------------- |
| BEGIN | 处理文本之前执行的操作     |
| END   | 处理完所有行之后执行的操作 |

[[awk高级用法]]
#### 输出
```shell
$ awk '{print "第一列："$1,"第三列"$3}' file
```
#### 输出第2至5行的第4列内容
```shell
awk 'NR==2,NR==5{print $4}' file
```
#### 输出行号
```shell
awk '{print NR,$0}' file
```
#### 输出倒数第二列
```shell
awk '{print $(NF-1)}'
```
#### 输出第二列至最后一列
```shell
awk '{$1="";print $0}'
```
#### 设置分隔符
```shell
awk -F '<分隔符>' '{print <参数>}' file
```
#### 格式化输出
```shell
awk '{printf "%-20s %+d\n",$1,$2}'
```
- `%-20s` => 左对齐，宽度20
- `%+d` => 显示数字符号
#### 正则匹配
```shell
awk '/\/sbin\/nologin$/{print NR,$0}' file
```
#### 输出前输出内容
```shell
awk 'BEGIN{print "asd"}{print "asd"}'
```
#### 读取其他文件
```shell
awk -f <文件> <文件>
```
#### 以符号为换行符进行分割
```shell
awk 'BEGIN{RS="[a-z]+"}{print $1}'
```
#### 以符号为换行符进行输出
```shell
awk 'BEGIN{ORS="a"}{print $0}'
```
### sort
```shell
sort [-][-o<输出文件>][-t<分隔字符>] <文件> [-k 列号[,结束列号]]
```

| 参数 | 含义                                  |
| ---- | ------------------------------------- |
| -b   | 忽略每行前面开始出的空格字符。        |
| -c   | 检查文件是否已经按照顺序排序。        |
| -d   | 只排序英文字母、数字及空格字符        |
| -f   | 排序时，将小写字母视为大写字母。      |
| -i   | 只排序040至176之间的ASCII字符         |
| -m   | 将几个排序好的文件进行合并。          |
| -M   | 将前面3个字母依照月份的缩写进行排序。 |
| -n   | 依照数值的大小排序。                  |
| -u   | 去重排序                              |
| -r   | 以相反的顺序来排序。                  |

### fold
设定每行字符数
```shell
fold [-w<宽度>] <文件>
```
### head
查看文件的开头部分的内容
```shell
head [-][-n 行数] <文件>
```

| 参数 | 含义       |
| ---- | ---------- |
| -q   | 隐藏文件名 |
| -v   | 显示文件名 |

### uniq

```shell
uniq [-] <输入文件> <输出文件>
```

| 参数 | 含义                               |
| ---- | ---------------------------------- |
| -c   | 在每列旁边显示该行重复出现的次数 |
| -d   | 仅显示重复出现的行列             |

### cut
分割文件
```shell
cut -c<数字> <文件>
cut -b<数字> <文件>
```

| 参数 | 含义           |
| ---- | -------------- |
| -c   | 按字符进行分割 |
| -b   | 按字节进行分割 |

### wc
计算文件的Byte数、字数、或是列数
```shell
wc [-] <多个文件>
```

| 参数 | 含义           |
| ---- | -------------- |
| -c   | 只显示字节数。 |
| -l   | 显示行数。     |
| -w   | 只显示字数。   |

### shuf
随机打乱行数
```shell
$ cat list.dat
111
222
333
$ cat list.dat | shuf
222
111
333
```
### tac
倒序输出
```shell
tac
```
### 加密
常用`md5sum`,`sha256sum`
```shell
$ echo "123" | sha256sum
181210f8f9c779c26da1d9b2075bde0127302ee0e3fca38c9a83f5b1dd8e5d3b  -
```
## 进程管理
### 查看进程 ps
#todo 
```shell
ps [-]
```

| 参数 | 含义                                           |
| ---- | ---------------------------------------------- |
| a    | 显示现行终端机下的所有程序，包括其他用户的程序 |
| -f   | 显示UID,PPIP,C与STIME栏位                      |
| e    | 列出程序时，显示每个程序所使用的环境变量       |
| f    | 用ASCII字符显示进程数                          |
| u    | 显示用户列                                     |
| x    | 显示所有程序，不以终端机来区分                 |

#### 查看本机所有用户的进程信息
```shell
ps aux | grep java
ps -ef | grep java
```
### 查看端口 lsof
```shell
lsof [-c <string>] [-u <用户名>] [-g <gid>] [+d <目录>] [-d <文件描述符>] [-i <TCP/UDP>\
<@hostname/hostaddr><:service/port>] <文件/目录>
```

| 参数 | 含义                                |
| ---- | ----------------------------------- |
| -c   | 查看COMMAND列中该进程所有打开的文件 |
| -i   | 查看网络连接/连接端口/服务情况      |

#### 查看使用apache可执行文件的进程
```shell
lsof `which httpd`
```
#### 显示abc进程现在打开的文件
```shell
lsof -c abc
```
#### 查看80端口运行情况
```shell
lsof -i:80
```
#### 查看root用户进程打开txt的文件
```shell
lsof -a -u root -d txt
```
#### 查看目前ftp连接的情况(持续)
```shell
lsof -i tcp@ohaha.ks.edu.tw:ftp -r
```
### 结束进程 kill
`kill -9 pid`
#### 结合
```shell
kill -9 `lsof -t -i:portNumber`
```
### 取消当前进程
<kbd>ctrl</kbd> + <kbd>c</kbd>
### 挂起当前进程
使进程到后台运行
<kbd>ctrl</kbd> + <kbd>z</kbd>
#### 使挂起的进程到前台运行
```shell
fg
```
### 使进程后台运行
```shell
nohup yourshell &
```
## 信息查看
### 系统信息
### 日期
```shell
date [-] <时间字符串>
```
- 时间

| 参数 | 含义                        |
| ---- | --------------------------- |
| `%%` | 打印 %                      |
| %n   | 换行                     |
| %t   | 跳格                        |
| %H   | 小时(00..23)                |
| %I   | 小时(01..12)                |
| %k   | 小时(0..23)                 |
| %l   | 小时(1..12)                 |
| %M   | 分钟(00..59)                |
| %p   | 显示本地 AM 或 PM           |
| %r   | 12 小时制，`hh:mm:ss [AP]M` |
| %s   | 时间戳(秒)                  |
| %S   | 当前秒(00..61)              |
| %N   | 当前纳秒                    |
| %T   | 直接显示时间 (24 小时制)    |
| %X   | 相当于 %H:%M:%S             |
| %Z   | 显示时区                    |

- 日期

| 参数 | 含义                                   |
| ---- | -------------------------------------- |
| %a   | 星期几 (Sun..Sat)                      |
| %A   | 星期几 (Sunday..Saturday)              |
| %b   | 月份 (Jan..Dec)                        |
| %B   | 月份 (January..December)               |
| %c   | 直接显示日期与时间                     |
| %d   | 日 (01..31)                            |
| %D   | 直接显示日期 (mm/dd/yy)                |
| %h   | 同 %b                                  |
| %j   | 一年中的第几天 (001..366)              |
| %m   | 月份 (01..12)                          |
| %U   | 一年中的第几周 (00..53) (周日为第一天) |
| %w   | 一周中的第几天 (0..6)                  |
| %W   | 一年中的第几周 (00..53) (周一为第一天) |
| %x   | 直接显示日期 (mm/dd/yy)                |
| %y   | 年份的最后两位数字 (00.99)             |
| %Y   | 完整年份 (0000..9999)                  |

#### 毫秒时间戳
```shell
echo $((date +%s))$((`date +%N`/1000000))
```
#### 随机字符串
```shell
$(date +%s%N${RANDOM}${RANDOM} | sha256sum | shuf | head -c10)
```
### 日志 sar
```shell
sar [-]
```

sar 的常用参数说明：
-r　　查看系统内存资源
-n　　查看系统网络资源
-u　　查看系统CPU资源
-d　　查看系统磁盘资源
-b　　查看系统的IO速率
-f　　从历史数据文件中获取数据，与上面的参数连用

```shell
sar 应用举例：
sar -r 1 5　　#查看系统当前内存使用情况，每隔一秒报告一次，连续报告5次
sar -n DEV 1 5　　#查看系统当前网络资源使用情况，每个一秒报告一次，连续报告5次
sar -d -f /var/log/sa/sa01　　#查看系统历史（1号）磁盘资源使用情况
sar -u -f /var/log/sa/sa01　　#查看系统历史（1号）CPU资源使用情况
```
#todo top ps test date ps tail