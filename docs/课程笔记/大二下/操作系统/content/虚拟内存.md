### 局部性原理
- 时间局部性：
如果程序中的某条指令一旦执行，不久后该指令可能再次执行；如果某数据被访问过，不久以后该数据可能再次被访问
- 空间局部性：
一旦程序访问了某个存储单元，不久后，其附近的存储单元也将被访问，即程序在一段时间内所访问的地址，可能集中在一定的范围以内
- 例子
	- CPU的Cache
	- 内存管理TLB
	- 虚拟内存
### 虚拟内存
类似商店的上货和换货，有需求时从仓库里拿出来放到店面里
![[Pasted image 20210616093256.png]]
#### 换页
帧数有限时需要添加和删除帧
ppt
==换页算法==
- FIFO先进先出
- MIN(OPT)未来最远未使用
- LRU
	- 最近最少使用(最早)的页淘汰
	- 二次机会算法(SCR)(Clock算法)
##### 换算
页号=逻辑地址/页长
业内地址=逻辑地址%页长
#### 例题
考虑下述页面走向：
     1，2，3，4，2，1，5，6，2，1，2，3，7，6，3，2，1，2，3，6
当内存块数量分别为3时（或者说是页框数是3，或者说帧数是3），试问FIFO、LRU、OPT(MIN)这三种置换算法的缺页次数各是多少，缺页中断率是多少？

| FIFO | 1     | 2     | 3     | 4     | 2     | 1     | 5     | 6     | 2     | 1     | 2     | 3     | 7     | 6     | 3     | 2     | 1     | 2     | 3     | 6     |
| ---- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 1    | ==1== | 1     | 1     | ==4== | 4     | 4     | 4     | ==6== | 6     | 6     | 6     | ==3== | 3     | 3     | **3** | ==2== | 2     | **2** | 2     | ==6== |
| 2    |       | ==2== | 2     | 2     | **2** | ==1== | 1     | 1     | ==2== | 2     | **2** | 2     | ==7== | 7     | 7     | 7     | ==1== | 1     | 1     | 1     |
| 3    |       |       | ==3== | 3     | 3     | 3     | ==5== | 5     | 5     | ==1== | 1     | 1     | 1     | ==6== | 6     | 6     | 6     | 6     | ==3== | 3     |

| MIN | 1     | 2     | 3     | 4     | 2     | 1     | 5     | 6     | 2     | 1     | 2     | 3     | 7     | 6     | 3     | 2     | 1     | 2     | 3     | 6     |
| --- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 1   | ==1== | 1     | 1     | 1     | 1     | **1** | 1     | 1     | 1     | **1** | 1     | ==3== | 3     | 3     | **3** | 3     | 3     | 3     | **3** | 3     |
| 2   |       | ==2== | 2     | 2     | **2** | 2     | 2     | 2     | **2** | 2     | **2** | 2     | ==7== | 7     | 7     | ==2== | 2     | **2** | 2     | 2     |
| 3   |       |       | ==3== | ==4== | 4     | 4     | ==5== | ==6== | 6     | 6     | 6     | 6     | 6     | **6** | 6     | 6     | ==1== | 1     | 1     | ==6== |

| LRU | 1     | 2     | 3     | 4     | 2     | 1     | 5     | 6     | 2     | 1     | 2     | 3     | 7     | 6     | 3     | 2     | 1     | 2     | 3     | 6     |
| --- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- | ----- |
| 1   | ==1== | 1     | 1     | ==4== | 4     | 4     | ==5== | 5     | 5     | ==1== | 1     | 1     | ==7== | 7     | 7     | ==2== | 2     | **2** | 2     | 2     |
| 2   |       | ==2== | 2     | 2     | **2** | 2     | 2     | ==6== | 6     | 6     | 6     | ==3== | 3     | 3     | **3** | 3     | 3     | 3     | **3** | 3     |
| 3   |       |       | ==3== | 3     | 3     | ==1== | 1     | 1     | ==2== | 2     | **2** | 2     | 2     | ==6== | 6     | 6     | ==1== | 1     | 1     | ==6== | 

| **算法** | **缺页次数** | **缺页中断率** |
| -------- | ------------ | -------------- |
| **FIFO** | **16**       | **80%**        |
| **MIN**  | **11**       | **55%**        |
| **LRU**  | **15**       | **75%**        |

### 提高内存利用率
1. 反向页表
2. 哈希页表
3. 多级页表

抖动

1. 时间片
2. 银行家
3. 地址映射
4. 换页
5. 有效访问时间
6. pv操作